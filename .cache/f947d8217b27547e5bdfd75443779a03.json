{"dependencies":[{"name":"./embedded","loc":{"line":5,"column":31}},{"name":"../document","loc":{"line":6,"column":23}},{"name":"./objectid","loc":{"line":7,"column":23}},{"name":"../services/document/cleanModifiedSubpaths","loc":{"line":8,"column":36}},{"name":"../utils","loc":{"line":9,"column":20}},{"name":"buffer"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar t=require(\"buffer\").Buffer,i=require(\"./embedded\"),e=require(\"../document\"),s=require(\"./objectid\"),r=require(\"../services/document/cleanModifiedSubpaths\"),a=require(\"../utils\"),n=a.isMongooseObject;function o(t,i,s){for(var r=[].concat(t),a=Object.keys(o.mixin),n=a.length,h=0;h<n;++h)r[a[h]]=o.mixin[a[h]];return r._path=i,r.isMongooseArray=!0,r.validators=[],r._atomics={},r._schema=void 0,s&&s instanceof e&&(r._parent=s,r._schema=s.schema.path(i)),r}function h(t,i){if(!i)return!1;for(var s=0;s<t.length;++s){var r=t[s];if(null==r)return!1;var a=r.constructor;if(!(r instanceof e)||a.modelName!==i&&a.baseModelName!==i)return!1}return!0}function c(t,i){var e=t._schema.caster.options&&t._schema.caster.options.ref;0===t.length&&i.length>0&&h(i,e)&&t._parent.populated(t._path,[],{model:i[0].constructor})}o.mixin={toBSON:function(){return this.toObject({transform:!1,virtuals:!1,_skipDepopulateTopLevel:!0,depopulate:!0,flattenDecimals:!1})},_atomics:void 0,_parent:void 0,_cast:function(i){var e,r=!1;return this._parent&&(r=this._parent.populated(this._path,!0)),r&&null!==i&&void 0!==i?(e=r.options.model||r.options.Model,(t.isBuffer(i)||i instanceof s||!a.isObject(i))&&(i={_id:i}),i.schema&&i.schema.discriminatorMapping&&void 0!==i.schema.discriminatorMapping.key||(i=new e(i)),this._schema.caster.applySetters(i,this._parent,!0)):this._schema.caster.applySetters(i,this._parent,!1)},_markModified:function(t,i){var e,s=this._parent;return s&&(e=this._path,arguments.length&&(e=null!=i?e+\".\"+this.indexOf(t)+\".\"+i:e+\".\"+t),s.markModified(e,arguments.length>0?t:s)),this},_registerAtomic:function(t,e){if(\"$set\"===t)return this._atomics={$set:e},this;var s,r=this._atomics;if(\"$pop\"===t&&!(\"$pop\"in r)){var a=this;this._parent.once(\"save\",function(){a._popped=a._shifted=null})}if(this._atomics.$set||Object.keys(r).length&&!(t in r))return this._atomics={$set:this},this;if(\"$pullAll\"===t||\"$pushAll\"===t||\"$addToSet\"===t)r[t]||(r[t]=[]),r[t]=r[t].concat(e);else if(\"$pullDocs\"===t){var n=r.$pull||(r.$pull={});e[0]instanceof i?(s=n.$or||(n.$or=[]),Array.prototype.push.apply(s,e.map(function(t){return t.toObject({transform:!1,virtuals:!1})}))):(s=n._id||(n._id={$in:[]})).$in=s.$in.concat(e)}else r[t]=e;return this},$__getAtomics:function(){var t=[],i=Object.keys(this._atomics),e=i.length;if(0===e)return t[0]=[\"$set\",this.toObject({depopulate:1,transform:!1,_isNested:!0,virtuals:!1})],t;for(;e--;){var s=i[e],r=this._atomics[s];n(r)?r=r.toObject({depopulate:1,transform:!1,_isNested:!0,virtuals:!1}):Array.isArray(r)?r=this.toObject.call(r,{depopulate:1,transform:!1,_isNested:!0}):r.valueOf&&(r=r.valueOf()),\"$addToSet\"===s&&(r={$each:r}),t.push([s,r])}return t},hasAtomics:function(){return this._atomics&&\"Object\"===this._atomics.constructor.name?Object.keys(this._atomics).length:0},_mapCast:function(t,i){return this._cast(t,this.length+i)},push:function(){c(this,arguments);var t=[].map.call(arguments,this._mapCast,this);t=this._schema.applySetters(t,this._parent,void 0,void 0,{skipDocumentArrayCast:!0});var i=[].push.apply(this,t);return this._registerAtomic(\"$pushAll\",t),this._markModified(),i},nonAtomicPush:function(){var t=[].map.call(arguments,this._mapCast,this),i=[].push.apply(this,t);return this._registerAtomic(\"$set\",this),this._markModified(),i},$pop:function(){if(this._registerAtomic(\"$pop\",1),this._markModified(),!this._popped)return this._popped=!0,[].pop.call(this)},pop:function(){var t=[].pop.call(this);return this._registerAtomic(\"$set\",this),this._markModified(),t},$shift:function(){if(this._registerAtomic(\"$pop\",-1),this._markModified(),!this._shifted)return this._shifted=!0,[].shift.call(this)},shift:function(){var t=[].shift.call(this);return this._registerAtomic(\"$set\",this),this._markModified(),t},pull:function(){for(var t,s=[].map.call(arguments,this._cast,this),a=this._parent.get(this._path),n=a.length;n--;){if((t=a[n])instanceof e)s.some(function(i){return t.equals(i)})&&[].splice.call(a,n,1);else~a.indexOf.call(s,t)&&[].splice.call(a,n,1)}return s[0]instanceof i?this._registerAtomic(\"$pullDocs\",s.map(function(t){return t._id||t})):this._registerAtomic(\"$pullAll\",s),this._markModified(),r(this._parent,this._path)>0&&this._registerAtomic(\"$set\",this),this},splice:function(){var t,i,e;if(c(this,Array.prototype.slice.call(arguments,2)),arguments.length){for(i=[],e=0;e<arguments.length;++e)i[e]=e<2?arguments[e]:this._cast(arguments[e],arguments[0]+(e-2));t=[].splice.apply(this,i),this._registerAtomic(\"$set\",this),this._markModified()}return t},unshift:function(){c(this,arguments);var t=[].map.call(arguments,this._cast,this);return t=this._schema.applySetters(t,this._parent),[].unshift.apply(this,t),this._registerAtomic(\"$set\",this),this._markModified(),this.length},sort:function(){var t=[].sort.apply(this,arguments);return this._registerAtomic(\"$set\",this),this._markModified(),t},addToSet:function(){c(this,arguments);var t=[].map.call(arguments,this._mapCast,this),e=[],s=\"\";return(t=this._schema.applySetters(t,this._parent))[0]instanceof i?s=\"doc\":t[0]instanceof Date&&(s=\"date\"),t.forEach(function(t){var i;switch(s){case\"doc\":i=this.some(function(i){return i.equals(t)});break;case\"date\":var r=+t;i=this.some(function(t){return+t===r});break;default:i=~this.indexOf(t)}i||([].push.call(this,t),this._registerAtomic(\"$addToSet\",t),this._markModified(),[].push.call(e,t))},this),e},set:function(t,i){var e=this._cast(i,t);return this[t]=e,this._markModified(t),this},toObject:function(t){return t&&t.depopulate?(t._isNested=!0,this.map(function(i){return i instanceof e?i.toObject(t):i})):this.slice()},inspect:function(){return JSON.stringify(this)},indexOf:function(t){t instanceof s&&(t=t.toString());for(var i=0,e=this.length;i<e;++i)if(t==this[i])return i;return-1}},o.mixin.remove=o.mixin.pull,module.exports=exports=o;"},"hash":"a71a904ec574d55a734edb8bb29b512e"}