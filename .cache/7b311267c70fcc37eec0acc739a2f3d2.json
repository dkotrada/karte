{"dependencies":[{"name":"events","loc":{"line":5,"column":27}},{"name":"./error","loc":{"line":6,"column":28}},{"name":"./schema/mixed","loc":{"line":7,"column":26}},{"name":"./schema","loc":{"line":8,"column":21}},{"name":"./error/objectExpected","loc":{"line":9,"column":34}},{"name":"./error/objectParameter","loc":{"line":10,"column":35}},{"name":"./error/strict","loc":{"line":11,"column":30}},{"name":"./schematype","loc":{"line":12,"column":29}},{"name":"./virtualtype","loc":{"line":13,"column":26}},{"name":"./utils","loc":{"line":14,"column":20}},{"name":"./services/projection/isDefiningProjection","loc":{"line":16,"column":35}},{"name":"util","loc":{"line":18,"column":22}},{"name":"./internal","loc":{"line":20,"column":28}},{"name":"./services/document/cleanModifiedSubpaths","loc":{"line":21,"column":36}},{"name":"./services/document/compile","loc":{"line":24,"column":24}},{"name":"hooks-fixed","loc":{"line":25,"column":20}},{"name":"./promise_provider","loc":{"line":26,"column":30}},{"name":"./services/common","loc":{"line":30,"column":22}},{"name":"mpath","loc":{"line":31,"column":20}},{"name":"./plugins/idGetter","loc":{"line":32,"column":23}},{"name":"./types/embedded","loc":{"line":1952,"column":33}},{"name":"./types/array","loc":{"line":890,"column":46}},{"name":"./types/documentarray","loc":{"line":1951,"column":44}},{"name":"process"},{"name":"buffer"}],"generated":{"js":"var process = require(\"process\");\nvar Buffer = require(\"buffer\").Buffer;\nvar t,e,i,r=require(\"process\"),s=require(\"buffer\").Buffer,o=require(\"events\").EventEmitter,n=require(\"./error\"),a=require(\"./schema/mixed\"),c=require(\"./schema\"),h=require(\"./error/objectExpected\"),u=require(\"./error/objectParameter\"),l=require(\"./error/strict\"),p=require(\"./schematype\").ValidatorError,f=require(\"./virtualtype\"),d=require(\"./utils\"),_=d.clone,v=require(\"./services/projection/isDefiningProjection\"),m=d.isMongooseObject,y=require(\"util\").inspect,$=n.ValidationError,g=require(\"./internal\"),b=require(\"./services/document/cleanModifiedSubpaths\"),O=require(\"./services/document/compile\").compile,j=d.deepEqual,P=require(\"./services/document/compile\").defineKey,k=require(\"hooks-fixed\"),E=require(\"./promise_provider\"),q=require(\"./services/common\").flatten,D=require(\"mpath\"),N=require(\"./plugins/idGetter\");function S(t,e,i,r){if(this.$__=new g,this.$__.emitter=new o,this.isNew=!0,this.errors=void 0,this.$__.$options=r||{},null!=t&&\"object\"!=typeof t)throw new u(t,\"obj\",\"Document\");var s=this.schema;\"boolean\"==typeof e?(this.$__.strictMode=e,e=void 0):(this.$__.strictMode=s.options&&s.options.strict,this.$__.selected=e);for(var n=s.requiredPaths(!0),a=0;a<n.length;++a)this.$__.activePaths.require(n[a]);if(this.$__.emitter.setMaxListeners(0),this._doc=this.$__buildDoc(t,e,i),t&&(t instanceof S&&(this.isNew=t.isNew),this.$__original_set?this.$__original_set(t,void 0,!0):this.$set(t,void 0,!0)),this.$__._id=this._id,!s.options.strict&&t){var c=this;Object.keys(this._doc).forEach(function(t){t in s.tree||P(t,null,c)})}A(this)}function V(t,e,i,r){r=r||\"\";var s,o,n,a=Object.keys(e),c=a.length,h=0;if(t.schema.options.retainKeyOrder)for(;h<c;)u(h++);else for(;c--;)u(c);function u(c){if(n=a[c],o=r+n,s=t.schema.path(o),!t.schema.$isRootDiscriminator||t.isSelected(o))if(s||!d.isObject(e[n])||e[n].constructor&&\"Object\"!==d.getFunctionName(e[n].constructor))if(s){if(null===e[n])i[n]=null;else if(void 0!==e[n])if(s)try{i[n]=s.cast(e[n],t,!0)}catch(e){t.invalidate(e.path,new p({path:e.path,message:e.message,type:\"cast\",value:e.value}))}else i[n]=e[n];t.isModified(o)||t.$__.activePaths.init(o)}else i[n]=e[n];else i[n]||(i[n]={}),V(t,e[n],i[n],o+\".\")}}d.each([\"on\",\"once\",\"emit\",\"listeners\",\"removeListener\",\"setMaxListeners\",\"removeAllListeners\",\"addListener\"],function(t){S.prototype[t]=function(){return this.$__.emitter[t].apply(this.$__.emitter,arguments)}}),S.prototype.constructor=S,S.prototype.schema,S.prototype.isNew,S.prototype.id,S.prototype.errors,S.prototype.$__buildDoc=function(t,e,i){var r,s,o={},n=null;if(e&&\"Object\"===d.getFunctionName(e.constructor))if(1===(s=(r=Object.keys(e)).length)&&\"_id\"===r[0])n=!!e[r[s]];else for(;s--;)if(\"_id\"!==r[s]&&v(e[r[s]])){n=!e[r[s]];break}var a=Object.keys(this.schema.paths),c=a.length,h=0,u={};if(!1===n&&e){r=Object.keys(e);for(var l=0;l<r.length;++l)for(var p=r[l].split(\".\"),f=[],_=0;_<p.length;++_)f.push(p[_]),u[f.join(\".\")]=1}for(;h<c;++h){var m=a[h];if(\"_id\"===m){if(i)continue;if(t&&\"_id\"in t)continue}for(var y=this.schema.paths[m],$=m.split(\".\"),g=$.length,b=g-1,O=\"\",j=o,P=0,k=!1;P<g;++P){var E,q=$[P];if(O+=(O.length?\".\":\"\")+q,!0===n){if(O in e)break}else if(!1===n&&e&&!k)if(O in e)k=!0;else if(!u[O])break;if(P===b)if(e&&null!==n)if(!0===n){if(m in e)continue;void 0!==(E=y.getDefault(this,!1))&&(j[q]=E,this.$__.activePaths.default(m))}else k&&void 0!==(E=y.getDefault(this,!1))&&(j[q]=E,this.$__.activePaths.default(m));else void 0!==(E=y.getDefault(this,!1))&&(j[q]=E,this.$__.activePaths.default(m));else j=j[q]||(j[q]={})}}return o},S.prototype.toBSON=function(){return this.toObject({transform:!1,virtuals:!1,_skipDepopulateTopLevel:!0,depopulate:!0,flattenDecimals:!1})},S.prototype.init=function(t,e,i){if(\"function\"==typeof e&&(i=e,e=null),this.isNew=!1,this.$init=!0,null!==t._id&&void 0!==t._id&&e&&e.populated&&e.populated.length)for(var r=String(t._id),s=0;s<e.populated.length;++s){var o=e.populated[s];o.isVirtual?this.populated(o.path,d.getValue(o.path,t),o):this.populated(o.path,o._docs[r],o)}return V(this,t,this._doc),this.emit(\"init\",this),this.constructor.emit(\"init\",this),this.$__._id=this._id,i&&i(null),this};for(var M in k)\"post\"===M?S.prototype[\"$\"+M]=S[\"$\"+M]=k[M]:\"pre\"===M?S.prototype.$pre=S.$pre=function(){if(\"set\"===arguments[0]){var t=Array.prototype.slice.call(arguments);t[0]=\"$set\",k.pre.apply(this,t)}return k.pre.apply(this,arguments)}:S.prototype[M]=S[M]=k[M];function w(t){var e,i,r=Object.keys(t.$__.activePaths.states.require).filter(function(e){if(!t.isSelected(e)&&!t.isModified(e))return!1;var i=t.schema.path(e);return\"function\"!=typeof i.originalRequiredValue||i.originalRequiredValue.call(t)});if(r=(r=(r=r.concat(Object.keys(t.$__.activePaths.states.init))).concat(Object.keys(t.$__.activePaths.states.modify))).concat(Object.keys(t.$__.activePaths.states.default)),!t.ownerDocument){var s,o=t.$__getAllSubdocs();for(i=o.length,e=0;e<i;++e)s=o[e],t.isModified(s.$basePath)&&!t.isDirectModified(s.$basePath)&&(r=r.filter(function(t){return null!=t&&0!==t.indexOf(s.$basePath+\".\")})).push(s.$basePath)}for(i=r.length,e=0;e<i;++e){var n=r[e],a=t.schema.path(n);if(a&&a.$isMongooseArray&&!a.$isMongooseDocumentArray){var c=t.getValue(n);if(c)for(var h=c.length,u=0;u<h;++u)r.push(n+\".\"+u)}}var l={skipArrays:!0};for(i=r.length,e=0;e<i;++e){var p=r[e];if(t.schema.nested[p]){var f=t.getValue(p);m(f)&&(f=f.toObject({transform:!1}));var d=q(f,\"\",l),_=Object.keys(d).map(function(t){return p+\".\"+t});r=r.concat(_)}}return r}function A(t){var e=t.schema&&t.schema.callQueue;if(e.length)for(var i,r=0;r<e.length;++r)\"pre\"!==(i=e[r])[0]&&\"post\"!==i[0]&&\"on\"!==i[0]&&t[i[0]].apply(t,i[1])}function x(t){for(var e,i,r,o=Object.keys(t),n=o.length;n--;)r=t[i=o[n]],d.isObject(r)&&!s.isBuffer(r)&&(t[i]=x(r)),void 0!==t[i]?e=!0:delete t[i];return e?t:void 0}function K(t,e,i,r){var s,o,n=t.schema,a=Object.keys(n[i]),c=a.length,h=c,u=t._doc;if(!u)return e;if(\"virtuals\"===i){for(c=0;c<h;++c)if(f=(s=a[c]).split(\".\"),void 0!==(o=_(t.get(s),r))){d=f.length,u=e;for(var l=0;l<d-1;++l)u[f[l]]=u[f[l]]||{},u=u[f[l]];u[f[d-1]]=o}return e}for(;c--;){var p,f=(s=a[c]).split(\".\"),d=f.length,v=d-1,m=e;u=t._doc;for(var y=0;y<d;++y){if(o=u[p=f[y]],y===v)m[p]=_(t.get(s),r);else{if(null==o){p in u&&(m[p]=o);break}m=m[p]||(m[p]={})}u=o}}return e}S.prototype.update=function(){var t=d.args(arguments);return t.unshift({_id:this._id}),this.constructor.update.apply(this.constructor,t)},S.prototype.$set=function(t,e,i,r){i&&\"Object\"===d.getFunctionName(i.constructor)&&(r=i,i=void 0);var s=(r=r||{}).merge,o=i&&!0!==i,u=!0===i,p=\"strict\"in r?r.strict:this.$__.strictMode;if(o&&((this.$__.adhocPaths||(this.$__.adhocPaths={}))[t]=c.interpretAsType(t,i,this.schema.options)),\"string\"!=typeof t){if(null!==t&&void 0!==t){var f=e?e+\".\":\"\";t instanceof S&&(t=t.$__isNested?t.toObject():t._doc);var _,v,m=Object.keys(t),y=m.length,$=0;if(0===y&&!this.schema.options.minimize)return e&&this.$set(e,{}),this;if(this.schema.options.retainKeyOrder)for(;$<y;)O.call(this,$++);else for(;y--;)O.call(this,y);return this}var g=t;t=e,e=g}function O(e){v=m[e];var i=f+v;if(_=this.schema.pathType(i),null===t[v]||void 0===t[v]||!d.isObject(t[v])||t[v].constructor&&\"Object\"!==d.getFunctionName(t[v].constructor)||\"virtual\"===_||\"real\"===_||this.$__path(i)instanceof a||this.schema.paths[i]&&this.schema.paths[i].options&&this.schema.paths[i].options.ref)if(p){if(u&&void 0===t[v]&&void 0!==this.get(v))return;if(\"real\"===_||\"virtual\"===_){var r=t[v];this.schema.paths[i]&&this.schema.paths[i].$isSingleNested&&t[v]instanceof S&&(r=r.toObject({virtuals:!1,transform:!1})),this.$set(f+v,r,u)}else if(\"nested\"===_&&t[v]instanceof S)this.$set(f+v,t[v].toObject({transform:!1}),u);else if(\"throw\"===p)throw\"nested\"===_?new h(v,t[v]):new l(v)}else void 0!==t[v]&&this.$set(f+v,t[v],u);else this.$set(t[v],f+v,u)}var j,P=this.schema.pathType(t);if(\"nested\"===P&&e)return!d.isObject(e)||e.constructor&&\"Object\"!==d.getFunctionName(e.constructor)?(this.invalidate(t,new n.CastError(\"Object\",e,t)),this):(s||(this.setValue(t,null),b(this,t)),0===Object.keys(e).length?(this.setValue(t,{}),this.markModified(t),b(this,t)):this.$set(e,t,u),this);var k=t.split(\".\");if(\"adhocOrUndefined\"===P&&p){var E;for($=0;$<k.length;++$){var q=k.slice(0,$+1).join(\".\");if((j=this.schema.path(q))instanceof a){E=!0;break}if($+1<k.length&&\"virtual\"===this.schema.pathType(q))return D.set(t,e,this),this}if(!E){if(\"throw\"===p)throw new l(t);return this}}else{if(\"virtual\"===P)return(j=this.schema.virtualpath(t)).applySetters(e,this),this;j=this.$__path(t)}var N,V=this._doc,M=\"\";for($=0;$<k.length-1;++$)V=V[k[$]],M+=(M.length>0?\".\":\"\")+k[$],V||(this.$set(M,{}),this.isSelected(M)||this.unmarkModified(M),V=this.getValue(M));if(k.length<=1)N=t;else{for($=0;$<k.length;++$)if(q=k.slice(0,$+1).join(\".\"),this.isDirectModified(q)||null===this.get(q)){N=q;break}N||(N=t)}var w=u?void 0:this.getValue(t);if(!j)return this.$__set(N,t,u,k,j,e,w),this;var A=!0;try{var x,K=!1;j.options&&j.options.ref&&e instanceof S&&(j.options.ref===e.constructor.modelName||j.options.ref===e.constructor.baseModelName)&&(this.ownerDocument?this.ownerDocument().populated(this.$__fullPath(t),e._id,{model:e.constructor}):this.populated(t,e._id,{model:e.constructor}),K=!0),j.options&&Array.isArray(j.options[this.schema.options.typeKey])&&j.options[this.schema.options.typeKey].length&&j.options[this.schema.options.typeKey][0].ref&&Array.isArray(e)&&e.length>0&&e[0]instanceof S&&e[0].constructor.modelName&&(j.options[this.schema.options.typeKey][0].ref===e[0].constructor.baseModelName||j.options[this.schema.options.typeKey][0].ref===e[0].constructor.modelName)&&(this.ownerDocument?(x={model:e[0].constructor},this.ownerDocument().populated(this.$__fullPath(t),e.map(function(t){return t._id}),x)):(x={model:e[0].constructor},this.populated(t,e.map(function(t){return t._id}),x)),K=!0);var T=u&&this.$__.$options.priorDoc?this.$__.$options.priorDoc:this;e=j.applySetters(e,T,!1,w),!K&&this.$__.populated&&delete this.$__.populated[t],this.$markValid(t)}catch(i){this.invalidate(t,new n.CastError(j.instance,e,t,i)),A=!1}return A&&this.$__set(N,t,u,k,j,e,w),j.$isSingleNested&&(this.isDirectModified(t)||null==e)&&b(this,t),this},S.prototype.set=S.prototype.$set,S.prototype.$__shouldModify=function(t,e,i,r,s,o,n){return!!this.isNew||(void 0===o&&!this.isSelected(e)||!(void 0===o&&e in this.$__.activePaths.states.default)&&(!(this.populated(e)&&o instanceof S&&j(o._id,n))&&(!j(o,n||this.get(e))||!!(!i&&null!==o&&void 0!==o&&e in this.$__.activePaths.states.default&&j(o,s.getDefault(this,i))))))},S.prototype.$__set=function(t,r,s,o,n,a,c){i=i||require(\"./types/embedded\");var h=this;this.$__shouldModify(t,r,s,o,n,a,c)&&(this.markModified(t),e||(e=require(\"./types/array\")),a&&a.isMongooseArray&&(a._registerAtomic(\"$set\",a),a.isMongooseDocumentArray&&a.forEach(function(t){t&&t.__parentArray&&(t.__parentArray=a)}),this.$__.activePaths.forEach(function(t){0===t.indexOf(r+\".\")&&h.$__.activePaths.ignore(t)})));for(var u=this._doc,l=0,p=o.length,f=\"\";l<p;l++){var _=l+1===p;f+=f?\".\"+o[l]:o[l],_?u[o[l]]=a:u[o[l]]&&\"Object\"===d.getFunctionName(u[o[l]].constructor)?u=u[o[l]]:u[o[l]]&&u[o[l]]instanceof i?u=u[o[l]]:u[o[l]]&&u[o[l]].$isSingleNested?u=u[o[l]]:u[o[l]]&&Array.isArray(u[o[l]])?u=u[o[l]]:(u[o[l]]=u[o[l]]||{},u=u[o[l]])}},S.prototype.getValue=function(t){return d.getValue(t,this._doc)},S.prototype.setValue=function(t,e){return d.setValue(t,e,this._doc),this},S.prototype.get=function(t,e){var i;e&&(i=c.interpretAsType(t,e,this.schema.options));var r=this.$__path(t)||this.schema.virtualpath(t),s=t.split(\".\"),o=this._doc;if(r instanceof f)return r.applyGetters(null,this);for(var n=0,a=s.length;n<a;n++)o=null===o||void 0===o?void 0:o[s[n]];return i&&(o=i.cast(o)),r&&(o=r.applyGetters(o,this)),o},S.prototype.$__path=function(t){var e=this.$__.adhocPaths,i=e&&e[t];return i||this.schema.path(t)},S.prototype.markModified=function(t,e){this.$__.activePaths.modify(t),null==e||this.ownerDocument||(this.$__.pathsToScopes[t]=e)},S.prototype.unmarkModified=function(t){this.$__.activePaths.init(t),delete this.$__.pathsToScopes[t]},S.prototype.$ignore=function(t){this.$__.activePaths.ignore(t)},S.prototype.modifiedPaths=function(){return Object.keys(this.$__.activePaths.states.modify).reduce(function(t,e){var i=e.split(\".\");return t.concat(i.reduce(function(t,e,r){return t.concat(i.slice(0,r).concat(e).join(\".\"))},[]).filter(function(e){return-1===t.indexOf(e)}))},[])},S.prototype.isModified=function(t){if(t){Array.isArray(t)||(t=t.split(\" \"));var e=this.modifiedPaths(),i=Object.keys(this.$__.activePaths.states.modify);return t.some(function(t){return!!~e.indexOf(t)})||t.some(function(t){return i.some(function(e){return e===t||0===t.indexOf(e+\".\")})})}return this.$__.activePaths.some(\"modify\")},S.prototype.$isDefault=function(t){return t in this.$__.activePaths.states.default},S.prototype.$isDeleted=function(t){return 0===arguments.length?!!this.$__.isDeleted:(this.$__.isDeleted=!!t,this)},S.prototype.isDirectModified=function(t){return t in this.$__.activePaths.states.modify},S.prototype.isInit=function(t){return t in this.$__.activePaths.states.init},S.prototype.isSelected=function(t){if(this.$__.selected){if(\"_id\"===t)return 0!==this.$__.selected._id;var e,i=Object.keys(this.$__.selected),r=i.length,s=null;if(1===r&&\"_id\"===i[0])return 0===this.$__.selected._id;for(;r--;)if(\"_id\"!==(e=i[r])&&v(this.$__.selected[e])){s=!!this.$__.selected[e];break}if(null===s)return!0;if(t in this.$__.selected)return s;r=i.length;for(var o=t+\".\";r--;)if(\"_id\"!==(e=i[r])){if(0===e.indexOf(o))return s||e!==o;if(0===o.indexOf(e+\".\"))return s}return!s}return!0},S.prototype.isDirectSelected=function(t){if(this.$__.selected){if(\"_id\"===t)return 0!==this.$__.selected._id;var e,i=Object.keys(this.$__.selected),r=i.length,s=null;if(1===r&&\"_id\"===i[0])return 0===this.$__.selected._id;for(;r--;)if(\"_id\"!==(e=i[r])&&v(this.$__.selected[e])){s=!!this.$__.selected[e];break}return null===s||(t in this.$__.selected?s:!s)}return!0},S.prototype.validate=function(t,e){\"function\"==typeof t&&(e=t,t=null),this.$__validate(e||function(){})},S.prototype.$__validate=function(t){var e=this,i=function(){var t=e.$__.validationError;if(e.$__.validationError=void 0,e.emit(\"validate\",e),e.constructor.emit(\"validate\",e),t){for(var i in t.errors)!e.__parent&&t.errors[i]instanceof n.CastError&&e.invalidate(i,t.errors[i]);return t}},s=w(this);if(0===s.length)return r.nextTick(function(){var r=i();if(r)return e.schema.s.hooks.execPost(\"validate:error\",e,[e],{error:r},function(e){t(e)});t()});for(var o={},a=0,c=function(){var r=i();if(r)return e.schema.s.hooks.execPost(\"validate:error\",e,[e],{error:r},function(e){t(e)});t()},h=function(t){null==t||o[t]||(o[t]=!0,a++,r.nextTick(function(){var i=e.schema.path(t);if(!i)return--a||c();if(e.$isValid(t)){var r=e.getValue(t),s=t in e.$__.pathsToScopes?e.$__.pathsToScopes[t]:e;i.doValidate(r,function(i){i&&e.invalidate(t,i,void 0,!0),--a||c()},s)}else--a||c()}))},u=s.length,l=0;l<u;++l)h(s[l])},S.prototype.validateSync=function(t){var e=this;\"string\"==typeof t&&(t=t.split(\" \"));var i=w(this);if(t&&t.length){for(var r=[],s=0;s<i.length;++s)-1!==t.indexOf(i[s])&&r.push(i[s]);i=r}var o={};i.forEach(function(t){if(!o[t]){o[t]=!0;var i=e.schema.path(t);if(i&&e.$isValid(t)){var r=e.getValue(t),s=i.doValidateSync(r,e);s&&e.invalidate(t,s,void 0,!0)}}});var a=e.$__.validationError;if(e.$__.validationError=void 0,e.emit(\"validate\",e),e.constructor.emit(\"validate\",e),a)for(var c in a.errors)a.errors[c]instanceof n.CastError&&e.invalidate(c,a.errors[c]);return a},S.prototype.invalidate=function(t,e,i,r){if(this.$__.validationError||(this.$__.validationError=new $(this)),!this.$__.validationError.errors[t])return e&&\"string\"!=typeof e||(e=new p({path:t,message:e,type:r||\"user defined\",value:i})),this.$__.validationError===e?this.$__.validationError:(this.$__.validationError.addError(t,e),this.$__.validationError)},S.prototype.$markValid=function(t){this.$__.validationError&&this.$__.validationError.errors[t]&&(delete this.$__.validationError.errors[t],0===Object.keys(this.$__.validationError.errors).length&&(this.$__.validationError=null))},S.prototype.$isValid=function(t){return!this.$__.validationError||!this.$__.validationError.errors[t]},S.prototype.$__reset=function(){var e=this;return t||(t=require(\"./types/documentarray\")),this.$__.activePaths.map(\"init\",\"modify\",function(t){return e.getValue(t)}).filter(function(t){return t&&t instanceof Array&&t.isMongooseDocumentArray&&t.length}).forEach(function(t){for(var e=t.length;e--;){var i=t[e];i&&i.$__reset()}}),this.$__.activePaths.map(\"init\",\"modify\",function(t){return e.getValue(t)}).filter(function(t){return t&&t.$isSingleNested}).forEach(function(t){t.$__reset()}),this.$__dirty().forEach(function(t){var e=t.value;e&&e._atomics&&(e._atomics={})}),this.$__.activePaths.clear(\"modify\"),this.$__.activePaths.clear(\"default\"),this.$__.validationError=void 0,this.errors=void 0,e=this,this.schema.requiredPaths().forEach(function(t){e.$__.activePaths.require(t)}),this},S.prototype.$__dirty=function(){var t=this,e=this.$__.activePaths.map(\"modify\",function(e){return{path:e,value:t.getValue(e),schema:t.$__path(e)}});(e=e.concat(this.$__.activePaths.map(\"default\",function(e){if(\"_id\"!==e&&t.getValue(e))return{path:e,value:t.getValue(e),schema:t.$__path(e)}}))).sort(function(t,e){return t.path<e.path?-1:t.path>e.path?1:0});var i,r,s=[];return e.forEach(function(t){t&&(0!==t.path.indexOf(i)?(i=t.path+\".\",s.push(t),r=t):r.value&&r.value._atomics&&r.value.hasAtomics()&&(r.value._atomics={},r.value._atomics.$set=r.value))}),r=i=null,s},S.prototype.$__setSchema=function(t){t.plugin(N,{deduplicate:!0}),O(t.tree,this,void 0,t.options),this.schema=t},S.prototype.$__getArrayPathsToValidate=function(){return t||(t=require(\"./types/documentarray\")),this.$__.activePaths.map(\"init\",\"modify\",function(t){return this.getValue(t)}.bind(this)).filter(function(t){return t&&t instanceof Array&&t.isMongooseDocumentArray&&t.length}).reduce(function(t,e){return t.concat(e)},[]).filter(function(t){return t})},S.prototype.$__getAllSubdocs=function(){t||(t=require(\"./types/documentarray\")),i=i||require(\"./types/embedded\");var e=this;return Object.keys(this._doc).reduce(function(t,r){return function t(e,r,s){var o=e[s];return o instanceof i&&r.push(o),o&&o.$isSingleNested&&(r=Object.keys(o._doc).reduce(function(e,i){return t(o._doc,e,i)},r)).push(o),o&&o.isMongooseDocumentArray?o.forEach(function(e){e&&e._doc&&(e instanceof i&&r.push(e),r=Object.keys(e._doc).reduce(function(i,r){return t(e._doc,i,r)},r))}):o instanceof S&&o.$__isNested&&o&&(r=Object.keys(o).reduce(function(e,i){return t(o,e,i)},r)),r}(e,t,r)},[])},S.prototype.$__handleReject=function(t){this.listeners(\"error\").length?this.emit(\"error\",t):this.constructor.listeners&&this.constructor.listeners(\"error\").length?this.constructor.emit(\"error\",t):this.listeners&&this.listeners(\"error\").length&&this.emit(\"error\",t)},S.prototype.$toObject=function(t,e){var i={transform:!0,json:e,retainKeyOrder:this.schema.options.retainKeyOrder,flattenDecimals:!0};if(t&&t.depopulate&&t._isNested&&this.$__.wasPopulated)return _(this._id,t);(!t||\"Object\"!==d.getFunctionName(t.constructor)||t&&t._useSchemaOptions)&&(e?((t=this.schema.options.toJSON?_(this.schema.options.toJSON):{}).json=!0,t._useSchemaOptions=!0):((t=this.schema.options.toObject?_(this.schema.options.toObject):{}).json=!1,t._useSchemaOptions=!0));for(var r in i)void 0===t[r]&&(t[r]=i[r]);\"minimize\"in t||(t.minimize=this.schema.options.minimize);var s=t.transform;t._isNested=!0;var o=_(this._doc,t)||{};t.getters&&(K(this,o,\"paths\",t),t.minimize&&(o=x(o)||{})),(t.virtuals||t.getters&&!1!==t.virtuals)&&K(this,o,\"virtuals\",t),!1===t.versionKey&&this.schema.options.versionKey&&delete o[this.schema.options.versionKey];var n=t.transform;if(!0===n||this.schema.options.toObject&&n){var a=t.json?this.schema.options.toJSON:this.schema.options.toObject;a&&(n=\"function\"==typeof t.transform?t.transform:a.transform)}else t.transform=s;if(\"function\"==typeof n){var c=n(this,o,t);void 0!==c&&(o=c)}return o},S.prototype.toObject=function(t){return this.$toObject(t)},S.prototype.toJSON=function(t){return this.$toObject(t,!0)},S.prototype.inspect=function(t){var e;return t&&\"Object\"===d.getFunctionName(t.constructor)&&((e=t).minimize=!1,e.retainKeyOrder=!0),this.toObject(e)},S.prototype.toString=function(){return y(this.inspect())},S.prototype.equals=function(t){if(!t)return!1;var e=this.get(\"_id\"),i=t.get?t.get(\"_id\"):t;return e||i?e&&e.equals?e.equals(i):e===i:j(this,t)},S.prototype.populate=function(){if(0===arguments.length)return this;var t,e=this.$__.populate||(this.$__.populate={}),i=d.args(arguments);if(\"function\"==typeof i[i.length-1]&&(t=i.pop()),i.length)for(var r=d.populate.apply(null,i),s=0;s<r.length;++s)e[r[s].path]=r[s];if(t){var o=d.object.vals(e);this.$__.populate=void 0,o.__noPromise=!0;var n=this.constructor;if(this.$__isNested){n=this.$__.scope.constructor;var a=this.$__.nestedPath;o.forEach(function(t){t.path=a+\".\"+t.path})}n.populate(this,o,t)}return this},S.prototype.execPopulate=function(){var t=this;return new(E.get().ES6)(function(e,i){t.populate(function(t,r){t?i(t):e(r)})})},S.prototype.populated=function(t,e,i){if(null===e||void 0===e){if(!this.$__.populated)return;var r=this.$__.populated[t];return r?r.value:void 0}if(!0===e){if(!this.$__.populated)return;return this.$__.populated[t]}return this.$__.populated||(this.$__.populated={}),this.$__.populated[t]={value:e,options:i},e},S.prototype.depopulate=function(t){\"string\"==typeof t&&(t=t.split(\" \"));for(var e=0;e<t.length;e++){var i=this.populated(t[e]);i&&(delete this.$__.populated[t[e]],this.$set(t[e],i))}return this},S.prototype.$__fullPath=function(t){return t||\"\"},S.ValidationError=$,module.exports=exports=S;"},"hash":"22ee38f8c28ea60b6e2221514b6a4d4c"}