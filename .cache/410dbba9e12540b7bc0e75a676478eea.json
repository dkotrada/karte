{"dependencies":[{"name":"./schema/operators/exists","loc":{"line":5,"column":22}},{"name":"./schema/operators/type","loc":{"line":6,"column":20}},{"name":"./utils","loc":{"line":7,"column":20}},{"name":"./error","loc":{"line":8,"column":28}},{"name":"util","loc":{"line":880,"column":34}},{"name":"buffer"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar t=require(\"buffer\").Buffer,e=require(\"./schema/operators/exists\"),i=require(\"./schema/operators/type\"),r=require(\"./utils\"),n=require(\"./error\"),s=n.CastError,o=n.ValidatorError;function a(t,e,i){this.path=t,this.instance=i,this.validators=[],this.setters=[],this.getters=[],this.options=e,this._index=null,this.selected;for(var r in e)if(this[r]&&\"function\"==typeof this[r]){if(\"index\"===r&&this._index)continue;var n=e[r];if(\"default\"===r){this.default(n);continue}var s=Array.isArray(n)?n:[n];this[r].apply(this,s)}Object.defineProperty(this,\"$$context\",{enumerable:!1,configurable:!1,writable:!0,value:null})}function u(t,e,i,r,n){var s=!1,o=t.call(e,i,function(t,e){s||(s=!0,\"boolean\"!=typeof o&&(e&&(r.message=e),n(t,r)))});\"boolean\"==typeof o?(s=!0,n(o,r)):o&&\"function\"==typeof o.then&&o.then(function(t){s||(s=!0,n(t,r))},function(t){s||(s=!0,r.reason=t,n(!1,r))})}a.prototype.default=function(t){return 1===arguments.length?void 0===t?void(this.defaultValue=void 0):(this.defaultValue=t,this.defaultValue):(arguments.length>1&&(this.defaultValue=r.args(arguments)),this.defaultValue)},a.prototype.index=function(t){return this._index=t,r.expires(this._index),this},a.prototype.unique=function(t){if(!1===this._index){if(!t)return;throw new Error('Path \"'+this.path+'\" may not have `index` set to false and `unique` set to true')}return null==this._index||!0===this._index?this._index={}:\"string\"==typeof this._index&&(this._index={type:this._index}),this._index.unique=t,this},a.prototype.text=function(t){return null===this._index||void 0===this._index||\"boolean\"==typeof this._index?this._index={}:\"string\"==typeof this._index&&(this._index={type:this._index}),this._index.text=t,this},a.prototype.sparse=function(t){return null===this._index||void 0===this._index||\"boolean\"==typeof this._index?this._index={}:\"string\"==typeof this._index&&(this._index={type:this._index}),this._index.sparse=t,this},a.prototype.set=function(t){if(\"function\"!=typeof t)throw new TypeError(\"A setter must be a function.\");return this.setters.push(t),this},a.prototype.get=function(t){if(\"function\"!=typeof t)throw new TypeError(\"A getter must be a function.\");return this.getters.push(t),this},a.prototype.validate=function(t,e,i){var s,o,a,u;if(\"function\"==typeof t||t&&\"RegExp\"===r.getFunctionName(t.constructor))return e instanceof Object&&!i?((s=r.clone(e)).message||(s.message=s.msg),s.validator=t,s.type=s.type||\"user defined\"):(e||(e=n.messages.general.default),i||(i=\"user defined\"),s={message:e,type:i,validator:t}),this.validators.push(s),this;for(o=0,a=arguments.length;o<a;o++){if(!(u=arguments[o])||\"Object\"!==r.getFunctionName(u.constructor))throw new Error(\"Invalid validator. Received (\"+typeof u+\") \"+u+\". See http://mongoosejs.com/docs/api.html#schematype_SchemaType-validate\");this.validate(u.validator,u)}return this},a.prototype.required=function(t,e){var i={};if(\"object\"==typeof t&&(e=(i=t).message||e,t=t.isRequired),!1===t)return this.validators=this.validators.filter(function(t){return t.validator!==this.requiredValidator},this),this.isRequired=!1,this;var s=this;this.isRequired=!0,this.requiredValidator=function(e){return\"isSelected\"in this&&!this.isSelected(s.path)&&!this.isModified(s.path)||(\"function\"==typeof t&&!t.apply(this)||s.checkRequired(e,this))},this.originalRequiredValue=t,\"string\"==typeof t&&(e=t,t=void 0);var o=e||n.messages.general.required;return this.validators.unshift(r.assign({},i,{validator:this.requiredValidator,message:o,type:\"required\"})),this},a.prototype.getDefault=function(t,e){var i=\"function\"==typeof this.defaultValue?this.defaultValue.call(t):this.defaultValue;if(null!==i&&void 0!==i){\"object\"!=typeof i||this.options&&this.options.shared||(i=r.clone(i,{retainKeyOrder:!0}));var n=this.cast(i,t,e);return n&&n.$isSingleNested&&(n.$parent=t),n}return i},a.prototype._applySetters=function(t,e,i,r){for(var n=t,s=this.setters,o=s.length,a=this.caster;o--;)n=s[o].call(e,n,this);if(Array.isArray(n)&&a&&a.setters){for(var u=[],h=0;h<n.length;h++)u.push(a.applySetters(n[h],e,i,r));n=u}return n},a.prototype.applySetters=function(t,e,i,r,n){var s=this._applySetters(t,e,i,r,n);return null==s?s:s=this.cast(s,e,i,r,n)},a.prototype.applyGetters=function(t,e){var i=t,r=this.getters,n=r.length;if(!n)return i;for(;n--;)i=r[n].call(e,i,this);return i},a.prototype.select=function(t){return this.selected=!!t,this},a.prototype.doValidate=function(t,e,i){var n=!1,s=this.path,a=this.validators.length;if(!a)return e(null);var l=function(t,i){if(!n)if(void 0===t||t)--a||e(null);else{var r=i.ErrorConstructor||o;(n=new r(i)).$isValidatorError=!0,e(n)}},f=this;this.validators.forEach(function(e){if(!n){var o,a=e.validator,c=r.clone(e);if(c.path=s,c.value=t,a instanceof RegExp)l(a.test(t),c);else if(\"function\"==typeof a){if(void 0===t&&a!==f.requiredValidator)return void l(!0,c);if(c.isAsync)u(a,i,t,c,l);else if(2!==a.length||\"isAsync\"in c){try{o=a.call(i,t)}catch(t){o=!1,c.reason=t}o&&\"function\"==typeof o.then?o.then(function(t){l(t,c)},function(t){c.reason=t,l(o=!1,c)}):l(o,c)}else h(a,i,t,c,l)}}})};var h=require(\"util\").deprecate(u,\"Implicit async custom validators (custom validators that take 2 arguments) are deprecated in mongoose >= 4.9.0. See http://mongoosejs.com/docs/validation.html#async-custom-validators for more info.\");function l(t){return this.castForQuery(t)}function f(t){var e=this;return Array.isArray(t)?t.map(function(t){return e.castForQuery(t)}):[this.castForQuery(t)]}a.prototype.doValidateSync=function(t,e){var i=null,n=this.path;if(!this.validators.length)return null;var s=function(t,e){if(!i&&void 0!==t&&!t){var r=e.ErrorConstructor||o;(i=new r(e)).$isValidatorError=!0}},a=this.validators;if(void 0===t){if(!(this.validators.length>0&&\"required\"===this.validators[0].type))return null;a=[this.validators[0]]}return a.forEach(function(o){if(!i){var a,u=o.validator,h=r.clone(o);if(h.path=n,h.value=t,u instanceof RegExp)s(u.test(t),h);else if(\"function\"==typeof u&&2!==u.length&&!h.isAsync){try{a=u.call(e,t)}catch(t){a=!1,h.reason=t}s(a,h)}}}),i},a._isRef=function(e,i,n,s){var o=s&&e.options&&e.options.ref;if(!o&&n&&n.$__fullPath){var a=n.$__fullPath(e.path);o=(n.ownerDocument?n.ownerDocument():n).populated(a)}if(o){if(null==i)return!0;if(!t.isBuffer(i)&&\"Binary\"!==i._bsontype&&r.isObject(i))return!0}return!1},a.prototype.$conditionalHandlers={$all:f,$eq:l,$in:f,$ne:l,$nin:f,$exists:e,$type:i},a.prototype.castForQueryWrapper=function(t){return this.$$context=t.context,\"$conditional\"in t?this.castForQuery(t.$conditional,t.val):t.$skipQueryCastForUpdate?this._castForQuery(t.val):this.castForQuery(t.val)},a.prototype.castForQuery=function(t,e){var i;if(2===arguments.length){if(!(i=this.$conditionalHandlers[t]))throw new Error(\"Can't use \"+t);return i.call(this,e)}return e=t,this._castForQuery(e)},a.prototype._castForQuery=function(t){var e=!1;return this.$$context&&this.$$context.options&&\"runSettersOnQuery\"in this.$$context.options?e=this.$$context.options.runSettersOnQuery:this.options&&\"runSettersOnQuery\"in this.options&&(e=this.options.runSettersOnQuery),e?this.applySetters(t,this.$$context):this.cast(t)},a.prototype.checkRequired=function(t){return null!=t},module.exports=exports=a,exports.CastError=s,exports.ValidatorError=o;"},"hash":"c0208e15f4328025ac243654c67a3707"}