{"dependencies":[{"name":"http-errors","loc":{"line":15,"column":26}},{"name":"debug","loc":{"line":16,"column":20}},{"name":"depd","loc":{"line":17,"column":24}},{"name":"destroy","loc":{"line":18,"column":22}},{"name":"encodeurl","loc":{"line":19,"column":24}},{"name":"escape-html","loc":{"line":20,"column":25}},{"name":"etag","loc":{"line":21,"column":19}},{"name":"fresh","loc":{"line":22,"column":20}},{"name":"fs","loc":{"line":23,"column":17}},{"name":"mime","loc":{"line":24,"column":19}},{"name":"ms","loc":{"line":25,"column":17}},{"name":"on-finished","loc":{"line":26,"column":25}},{"name":"range-parser","loc":{"line":27,"column":25}},{"name":"path","loc":{"line":28,"column":19}},{"name":"statuses","loc":{"line":29,"column":23}},{"name":"stream","loc":{"line":30,"column":21}},{"name":"util","loc":{"line":31,"column":19}},{"name":"buffer"}],"generated":{"js":"var Buffer = require(\"buffer\").Buffer;\nvar e=require(\"buffer\").Buffer,t=require(\"http-errors\"),r=require(\"debug\")(\"send\"),i=require(\"depd\")(\"send\"),n=require(\"destroy\"),o=require(\"encodeurl\"),s=require(\"escape-html\"),a=require(\"etag\"),h=require(\"fresh\"),d=require(\"fs\"),f=require(\"mime\"),u=require(\"ms\"),c=require(\"on-finished\"),l=require(\"range-parser\"),p=require(\"path\"),g=require(\"statuses\"),m=require(\"stream\"),y=require(\"util\"),v=p.extname,x=p.join,_=p.normalize,C=p.resolve,H=p.sep,b=/^ *bytes=/,q=31536e6,T=/(?:^|[\\\\/])\\.\\.(?:[\\\\/]|$)/;function E(e,t,r){return new N(e,t,r)}function N(e,t,r){m.call(this);var n=r||{};if(this.options=n,this.path=t,this.req=e,this._acceptRanges=void 0===n.acceptRanges||Boolean(n.acceptRanges),this._cacheControl=void 0===n.cacheControl||Boolean(n.cacheControl),this._etag=void 0===n.etag||Boolean(n.etag),this._dotfiles=void 0!==n.dotfiles?n.dotfiles:\"ignore\",\"ignore\"!==this._dotfiles&&\"allow\"!==this._dotfiles&&\"deny\"!==this._dotfiles)throw new TypeError('dotfiles option must be \"allow\", \"deny\", or \"ignore\"');this._hidden=Boolean(n.hidden),void 0!==n.hidden&&i(\"hidden: use dotfiles: '\"+(this._hidden?\"allow\":\"ignore\")+\"' instead\"),void 0===n.dotfiles&&(this._dotfiles=void 0),this._extensions=void 0!==n.extensions?k(n.extensions,\"extensions option\"):[],this._immutable=void 0!==n.immutable&&Boolean(n.immutable),this._index=void 0!==n.index?k(n.index,\"index option\"):[\"index.html\"],this._lastModified=void 0===n.lastModified||Boolean(n.lastModified),this._maxage=n.maxAge||n.maxage,this._maxage=\"string\"==typeof this._maxage?u(this._maxage):Number(this._maxage),this._maxage=isNaN(this._maxage)?0:Math.min(Math.max(0,this._maxage),q),this._root=n.root?C(n.root):null,!this._root&&n.from&&this.from(n.from)}function M(e){for(var t=L(e),r=0;r<t.length;r++)e.removeHeader(t[r])}function R(e){for(var t=0;t<e.length&&\"/\"===e[t];t++);return t>1?\"/\"+e.substr(t):e}function S(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.length>1&&\".\"===r[0])return!0}return!1}function w(e,t,r){return e+\" \"+(r?r.start+\"-\"+r.end:\"*\")+\"/\"+t}function O(e,t){return'<!DOCTYPE html>\\n<html lang=\"en\">\\n<head>\\n<meta charset=\"utf-8\">\\n<title>'+e+\"</title>\\n</head>\\n<body>\\n<pre>\"+t+\"</pre>\\n</body>\\n<html>\\n\"}function F(e){try{return decodeURIComponent(e)}catch(e){return-1}}function L(e){return\"function\"!=typeof e.getHeaderNames?Object.keys(e._headers||{}):e.getHeaderNames()}function B(e,t){return(\"function\"!=typeof e.listenerCount?e.listeners(t).length:e.listenerCount(t))>0}function A(e){return\"boolean\"!=typeof e.headersSent?Boolean(e._header):e.headersSent}function k(e,t){for(var r=[].concat(e||[]),i=0;i<r.length;i++)if(\"string\"!=typeof r[i])throw new TypeError(t+\" must be array of strings or false\");return r}function D(e){var t=e&&Date.parse(e);return\"number\"==typeof t?t:NaN}function P(e){for(var t=0,r=[],i=0,n=0,o=e.length;n<o;n++)switch(e.charCodeAt(n)){case 32:i===t&&(i=t=n+1);break;case 44:r.push(e.substring(i,t)),i=t=n+1;break;default:t=n+1}return r.push(e.substring(i,t)),r}function j(e,t){for(var r=Object.keys(t),i=0;i<r.length;i++){var n=r[i];e.setHeader(n,t[n])}}module.exports=E,module.exports.mime=f,y.inherits(N,m),N.prototype.etag=i.function(function(e){return this._etag=Boolean(e),r(\"etag %s\",this._etag),this},\"send.etag: pass etag as option\"),N.prototype.hidden=i.function(function(e){return this._hidden=Boolean(e),this._dotfiles=void 0,r(\"hidden %s\",this._hidden),this},\"send.hidden: use dotfiles option\"),N.prototype.index=i.function(function(e){var t=e?k(e,\"paths argument\"):[];return r(\"index %o\",e),this._index=t,this},\"send.index: pass index as option\"),N.prototype.root=function(e){return this._root=C(String(e)),r(\"root %s\",this._root),this},N.prototype.from=i.function(N.prototype.root,\"send.from: pass root as option\"),N.prototype.root=i.function(N.prototype.root,\"send.root: pass root as option\"),N.prototype.maxage=i.function(function(e){return this._maxage=\"string\"==typeof e?u(e):Number(e),this._maxage=isNaN(this._maxage)?0:Math.min(Math.max(0,this._maxage),q),r(\"max-age %d\",this._maxage),this},\"send.maxage: pass maxAge as option\"),N.prototype.error=function(r,i){if(B(this,\"error\"))return this.emit(\"error\",t(r,i,{expose:!1}));var n=this.res,o=g[r]||String(r),a=O(\"Error\",s(o));M(n),i&&i.headers&&j(n,i.headers),n.statusCode=r,n.setHeader(\"Content-Type\",\"text/html; charset=UTF-8\"),n.setHeader(\"Content-Length\",e.byteLength(a)),n.setHeader(\"Content-Security-Policy\",\"default-src 'self'\"),n.setHeader(\"X-Content-Type-Options\",\"nosniff\"),n.end(a)},N.prototype.hasTrailingSlash=function(){return\"/\"===this.path[this.path.length-1]},N.prototype.isConditionalGET=function(){return this.req.headers[\"if-match\"]||this.req.headers[\"if-unmodified-since\"]||this.req.headers[\"if-none-match\"]||this.req.headers[\"if-modified-since\"]},N.prototype.isPreconditionFailure=function(){var e=this.req,t=this.res,r=e.headers[\"if-match\"];if(r){var i=t.getHeader(\"ETag\");return!i||\"*\"!==r&&P(r).every(function(e){return e!==i&&e!==\"W/\"+i&&\"W/\"+e!==i})}var n=D(e.headers[\"if-unmodified-since\"]);if(!isNaN(n)){var o=D(t.getHeader(\"Last-Modified\"));return isNaN(o)||o>n}return!1},N.prototype.removeContentHeaderFields=function(){for(var e=this.res,t=L(e),r=0;r<t.length;r++){var i=t[r];\"content-\"===i.substr(0,8)&&\"content-location\"!==i&&e.removeHeader(i)}},N.prototype.notModified=function(){var e=this.res;r(\"not modified\"),this.removeContentHeaderFields(),e.statusCode=304,e.end()},N.prototype.headersAlreadySent=function(){var e=new Error(\"Can't set headers after they are sent.\");r(\"headers already sent\"),this.error(500,e)},N.prototype.isCachable=function(){var e=this.res.statusCode;return e>=200&&e<300||304===e},N.prototype.onStatError=function(e){switch(e.code){case\"ENAMETOOLONG\":case\"ENOENT\":case\"ENOTDIR\":this.error(404,e);break;default:this.error(500,e)}},N.prototype.isFresh=function(){return h(this.req.headers,{etag:this.res.getHeader(\"ETag\"),\"last-modified\":this.res.getHeader(\"Last-Modified\")})},N.prototype.isRangeFresh=function(){var e=this.req.headers[\"if-range\"];if(!e)return!0;if(-1!==e.indexOf('\"')){var t=this.res.getHeader(\"ETag\");return Boolean(t&&-1!==e.indexOf(t))}return D(this.res.getHeader(\"Last-Modified\"))<=D(e)},N.prototype.redirect=function(t){var r=this.res;if(B(this,\"directory\"))this.emit(\"directory\",r,t);else if(this.hasTrailingSlash())this.error(403);else{var i=o(R(this.path+\"/\")),n=O(\"Redirecting\",'Redirecting to <a href=\"'+s(i)+'\">'+s(i)+\"</a>\");r.statusCode=301,r.setHeader(\"Content-Type\",\"text/html; charset=UTF-8\"),r.setHeader(\"Content-Length\",e.byteLength(n)),r.setHeader(\"Content-Security-Policy\",\"default-src 'self'\"),r.setHeader(\"X-Content-Type-Options\",\"nosniff\"),r.setHeader(\"Location\",i),r.end(n)}},N.prototype.pipe=function(e){var t=this._root;this.res=e;var i,n=F(this.path);if(-1===n)return this.error(400),e;if(~n.indexOf(\"\\0\"))return this.error(400),e;if(null!==t){if(n&&(n=_(\".\"+H+n)),T.test(n))return r('malicious path \"%s\"',n),this.error(403),e;i=n.split(H),n=_(x(t,n)),t=_(t+H)}else{if(T.test(n))return r('malicious path \"%s\"',n),this.error(403),e;i=_(n).split(H),n=C(n)}if(S(i)){var o=this._dotfiles;switch(void 0===o&&(o=\".\"===i[i.length-1][0]?this._hidden?\"allow\":\"ignore\":\"allow\"),r('%s dotfile \"%s\"',o,n),o){case\"allow\":break;case\"deny\":return this.error(403),e;case\"ignore\":default:return this.error(404),e}}return this._index.length&&this.hasTrailingSlash()?(this.sendIndex(n),e):(this.sendFile(n),e)},N.prototype.send=function(e,t){var i=t.size,n=this.options,o={},s=this.res,a=this.req,h=a.headers.range,d=n.start||0;if(A(s))this.headersAlreadySent();else{if(r('pipe \"%s\"',e),this.setHeader(e,t),this.type(e),this.isConditionalGET()){if(this.isPreconditionFailure())return void this.error(412);if(this.isCachable()&&this.isFresh())return void this.notModified()}if(i=Math.max(0,i-d),void 0!==n.end){var f=n.end-d+1;i>f&&(i=f)}if(this._acceptRanges&&b.test(h)){if(h=l(i,h,{combine:!0}),this.isRangeFresh()||(r(\"range stale\"),h=-2),-1===h)return r(\"range unsatisfiable\"),s.setHeader(\"Content-Range\",w(\"bytes\",i)),this.error(416,{headers:{\"Content-Range\":s.getHeader(\"Content-Range\")}});-2!==h&&1===h.length&&(r(\"range %j\",h),s.statusCode=206,s.setHeader(\"Content-Range\",w(\"bytes\",i,h[0])),d+=h[0].start,i=h[0].end-h[0].start+1)}for(var u in n)o[u]=n[u];o.start=d,o.end=Math.max(d,d+i-1),s.setHeader(\"Content-Length\",i),\"HEAD\"!==a.method?this.stream(e,o):s.end()}},N.prototype.sendFile=function(e){var t=0,i=this;r('stat \"%s\"',e),d.stat(e,function(n,o){return n&&\"ENOENT\"===n.code&&!v(e)&&e[e.length-1]!==H?function n(o){if(i._extensions.length<=t)return o?i.onStatError(o):i.error(404);var s=e+\".\"+i._extensions[t++];r('stat \"%s\"',s);d.stat(s,function(e,t){return e?n(e):t.isDirectory()?n():(i.emit(\"file\",s,t),void i.send(s,t))})}(n):n?i.onStatError(n):o.isDirectory()?i.redirect(e):(i.emit(\"file\",e,o),void i.send(e,o))})},N.prototype.sendIndex=function(e){var t=-1,i=this;!function n(o){if(++t>=i._index.length)return o?i.onStatError(o):i.error(404);var s=x(e,i._index[t]);r('stat \"%s\"',s),d.stat(s,function(e,t){return e?n(e):t.isDirectory()?n():(i.emit(\"file\",s,t),void i.send(s,t))})}()},N.prototype.stream=function(e,t){var r=!1,i=this,o=this.res,s=d.createReadStream(e,t);this.emit(\"stream\",s),s.pipe(o),c(o,function(){r=!0,n(s)}),s.on(\"error\",function(e){r||(r=!0,n(s),i.onStatError(e))}),s.on(\"end\",function(){i.emit(\"end\")})},N.prototype.type=function(e){var t=this.res;if(!t.getHeader(\"Content-Type\")){var i=f.lookup(e);if(i){var n=f.charsets.lookup(i);r(\"content-type %s\",i),t.setHeader(\"Content-Type\",i+(n?\"; charset=\"+n:\"\"))}else r(\"no content-type\")}},N.prototype.setHeader=function(e,t){var i=this.res;if(this.emit(\"headers\",i,e,t),this._acceptRanges&&!i.getHeader(\"Accept-Ranges\")&&(r(\"accept ranges\"),i.setHeader(\"Accept-Ranges\",\"bytes\")),this._cacheControl&&!i.getHeader(\"Cache-Control\")){var n=\"public, max-age=\"+Math.floor(this._maxage/1e3);this._immutable&&(n+=\", immutable\"),r(\"cache-control %s\",n),i.setHeader(\"Cache-Control\",n)}if(this._lastModified&&!i.getHeader(\"Last-Modified\")){var o=t.mtime.toUTCString();r(\"modified %s\",o),i.setHeader(\"Last-Modified\",o)}if(this._etag&&!i.getHeader(\"ETag\")){var s=a(t);r(\"etag %s\",s),i.setHeader(\"ETag\",s)}};"},"hash":"f3e727966909aad02e1f0c046b693121"}