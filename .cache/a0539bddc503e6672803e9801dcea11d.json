{"dependencies":[{"name":"safe-buffer","loc":{"line":15,"column":21}},{"name":"debug","loc":{"line":16,"column":20}},{"name":"cookies","loc":{"line":17,"column":22}},{"name":"on-headers","loc":{"line":18,"column":24}}],"generated":{"js":"\n\"use strict\";var e=require(\"safe-buffer\").Buffer,t=require(\"debug\")(\"cookie-session\"),n=require(\"cookies\"),r=require(\"on-headers\");function s(e){var s=e||{},o=s.name||\"session\",c=s.keys;if(!c&&s.secret&&(c=[s.secret]),null==s.overwrite&&(s.overwrite=!0),null==s.httpOnly&&(s.httpOnly=!0),null==s.signed&&(s.signed=!0),!c&&s.signed)throw new Error(\".keys required.\");return t(\"session options %j\",s),function(e,a,l){var p,h=new n(e,a,{keys:c});e.sessionCookies=h,e.sessionOptions=Object.create(s),e.sessionKey=o,Object.defineProperty(e,\"session\",{configurable:!0,enumerable:!0,get:function(){if(p)return p;if(!1===p)return null;return p=f(e)||u(e)},set:function(e){if(null==e)return p=!1,e;if(\"object\"==typeof e)return p=i.create(this,e);throw new Error(\"req.session can only be set as null or an object.\")}}),r(a,function(){if(void 0!==p)try{!1===p?h.set(o,\"\",e.sessionOptions):p.isNew&&!p.isPopulated||!p.isChanged||p.save()}catch(e){t(\"error saving session %s\",e.message)}}),l()}}function i(e,t){if(Object.defineProperty(this,\"_ctx\",{value:e}),t)for(var n in t)this[n]=t[n]}function o(e){this.req=e,this._new=!0,this._val=void 0}function u(e){return t(\"new session\"),i.create(e)}function c(t){var n=e.from(t,\"base64\").toString(\"utf8\");return JSON.parse(n)}function a(t){var n=JSON.stringify(t);return e.from(n).toString(\"base64\")}function f(e){var n=e.sessionCookies,r=e.sessionKey,s=e.sessionOptions,o=n.get(r,s);if(o){t(\"parse %s\",o);try{return i.deserialize(e,o)}catch(e){return}}}module.exports=s,i.create=function(e,t){return new i(new o(e),t)},i.deserialize=function(e,t){var n=new o(e),r=c(t);return n._new=!1,n._val=t,new i(n,r)},i.serialize=function(e){return a(e)},Object.defineProperty(i.prototype,\"isChanged\",{get:function(){return this._ctx._new||this._ctx._val!==i.serialize(this)}}),Object.defineProperty(i.prototype,\"isNew\",{get:function(){return this._ctx._new}}),Object.defineProperty(i.prototype,\"length\",{get:function(){return Object.keys(this).length}}),Object.defineProperty(i.prototype,\"isPopulated\",{get:function(){return Boolean(this.length)}}),i.prototype.save=function(){var e=this._ctx,n=i.serialize(this),r=e.req.sessionCookies,s=e.req.sessionKey,o=e.req.sessionOptions;t(\"save %s\",n),r.set(s,n,o)};"},"hash":"5fd2d67b47a8020b97e8a4fd42d67e55"}